============================= test session starts ==============================
platform linux -- Python 3.9.16, pytest-7.4.2, pluggy-1.3.0
rootdir: /local/home/erichre/code/cid-framework
configfile: pytest.ini
collected 12 items

test_from_scratch.py::test_budgets_data 
-------------------------------- live log setup --------------------------------
20:14:55 [    INFO] Found credentials in environment variables.
20:14:55 [    INFO] account_id=317256447485 region=us-east-1
20:14:56 [    INFO] Waiting for stacks
20:14:56 [    INFO] 20:14:55	OptimizationManagementDataRoleStack	CREATE_IN_PROGRESS	User Initiated[0m
20:14:56 [    INFO] 20:14:55	OptimizationDataRoleStack	CREATE_IN_PROGRESS	User Initiated[0m
20:14:56 [    INFO] 20:14:56	OptimizationDataCollectionStack	CREATE_IN_PROGRESS	User Initiated[0m
20:15:01 [    INFO] 20:14:58	OptimizationManagementDataRoleStack	LambdaRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:01 [    INFO] 20:14:59	OptimizationDataRoleStack	LambdaRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:02 [    INFO] 20:15:01	OptimizationDataCollectionStack	S3CrawlerQue	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:07 [    INFO] 20:15:07	OptimizationDataCollectionStack	S3Bucket	CREATE_IN_PROGRESS	[0m
20:15:08 [    INFO] 20:15:04	OptimizationDataCollectionStack-AccountCollector-18LFX94RDWAI7	LambdaRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:13 [    INFO] 20:15:08	OptimizationDataCollectionStack	S3Bucket	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:19 [    INFO] [92m20:15:18	OptimizationManagementDataRoleStack	LambdaRole	CREATE_COMPLETE	[0m
20:15:19 [    INFO] 20:15:17	OptimizationDataRoleStack	InventoryCollectorPolicy	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:19 [    INFO] 20:15:18	OptimizationDataCollectionStack	LambdaAnalytics	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:24 [    INFO] [92m20:15:19	OptimizationManagementDataRoleStack	CREATE_COMPLETE	[0m
20:15:25 [    INFO] 20:15:22	OptimizationDataCollectionStack-AccountCollector-18LFX94RDWAI7	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:30 [    INFO] [92m20:15:30	OptimizationDataCollectionStack	S3Bucket	CREATE_COMPLETE	[0m
20:15:31 [    INFO] [92m20:15:30	OptimizationDataCollectionStack-AccountCollector-18LFX94RDWAI7	LambdaFunction	CREATE_COMPLETE	[0m
20:15:36 [    INFO] [92m20:15:35	OptimizationDataRoleStack	InventoryCollectorPolicy	CREATE_COMPLETE	[0m
20:15:36 [    INFO] 20:15:36	OptimizationDataCollectionStack	StepFunctionExecutionRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:36 [    INFO] [92m20:15:31	OptimizationDataCollectionStack-AccountCollector-18LFX94RDWAI7	CREATE_COMPLETE	[0m
20:15:42 [    INFO] [92m20:15:36	OptimizationDataRoleStack	CREATE_COMPLETE	[0m
20:15:42 [    INFO] [92m20:15:38	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:15:42 [    INFO] [92m20:15:37	OptimizationDataCollectionStack-PricingModule-901914VXIYMW	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:15:48 [    INFO] [92m20:15:47	OptimizationDataCollectionStack	GlueRole	CREATE_COMPLETE	[0m
20:15:54 [    INFO] 20:15:54	OptimizationDataCollectionStack	RDSUtilizationModule	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:54 [    INFO] 20:15:53	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	LambdaTriggerExport	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:15:54 [    INFO] 20:15:52	OptimizationDataCollectionStack-PricingModule-901914VXIYMW	EC2LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:00 [    INFO] 20:16:00	OptimizationDataCollectionStack-PricingModule-901914VXIYMW	CloudWatchTrigger	CREATE_IN_PROGRESS	[0m
20:16:01 [    INFO] [92m20:15:59	OptimizationDataCollectionStack-BudgetsModule-1JEK24VASV3FB	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:16:01 [    INFO] 20:15:55	OptimizationDataCollectionStack-CostAnomalyModule-131AXE2H8IVFO	CostAnomalyLambdaRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:01 [    INFO] [92m20:16:00	OptimizationDataCollectionStack-EcsChargebackModule-YGRWUOYW1MIN	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:16:01 [    INFO] [92m20:16:01	OptimizationDataCollectionStack-InventoryCollectorModule-QMOPTCKYVWHA	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:16:01 [    INFO] 20:15:55	OptimizationDataCollectionStack-OrgDataModule-1SFY1BLZ983WJ	LambdaRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:02 [    INFO] [92m20:16:01	OptimizationDataCollectionStack-RDSUtilizationModule-EZH21LE0O8LZ	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:16:02 [    INFO] 20:15:56	OptimizationDataCollectionStack-RightsizeModule-URWQVGSRRIKP	RightsizingLambdaRole	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:02 [    INFO] [92m20:15:59	OptimizationDataCollectionStack-TransitGatewayModule-10QOOXTMIQEO3	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:16:02 [    INFO] [92m20:15:59	OptimizationDataCollectionStack-TrustedAdvisorModule-1CTR7HBL4FS5W	LambdaAnalyticsExecutor	CREATE_COMPLETE	[0m
20:16:08 [    INFO] 20:16:03	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	CloudWatchTrigger	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:09 [    INFO] 20:16:01	OptimizationDataCollectionStack-PricingModule-901914VXIYMW	CloudWatchTrigger	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:09 [    INFO] [92m20:16:05	OptimizationDataCollectionStack-BudgetsModule-1JEK24VASV3FB	AthenaQuery	CREATE_COMPLETE	[0m
20:16:09 [    INFO] [92m20:16:04	OptimizationDataCollectionStack-EcsChargebackModule-YGRWUOYW1MIN	AthenaEC2CChargeBackQuery	CREATE_COMPLETE	[0m
20:16:10 [    INFO] [92m20:16:04	OptimizationDataCollectionStack-InventoryCollectorModule-QMOPTCKYVWHA	AthenaSnaphotAMIPricing	CREATE_COMPLETE	[0m
20:16:16 [    INFO] 20:16:13	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	ReplicationBucketsStackSet	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:17 [    INFO] 20:16:16	OptimizationDataCollectionStack-BudgetsModule-1JEK24VASV3FB	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:17 [    INFO] 20:16:13	OptimizationDataCollectionStack-CostAnomalyModule-131AXE2H8IVFO	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:17 [    INFO] 20:16:16	OptimizationDataCollectionStack-EcsChargebackModule-YGRWUOYW1MIN	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:17 [    INFO] 20:16:16	OptimizationDataCollectionStack-InventoryCollectorModule-QMOPTCKYVWHA	LambdaFunction	CREATE_IN_PROGRESS	[0m
20:16:17 [    INFO] 20:16:14	OptimizationDataCollectionStack-OrgDataModule-1SFY1BLZ983WJ	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:18 [    INFO] 20:16:17	OptimizationDataCollectionStack-RDSUtilizationModule-EZH21LE0O8LZ	LambdaFunction	CREATE_IN_PROGRESS	[0m
20:16:18 [    INFO] 20:16:15	OptimizationDataCollectionStack-RightsizeModule-URWQVGSRRIKP	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:18 [    INFO] 20:16:16	OptimizationDataCollectionStack-TransitGatewayModule-10QOOXTMIQEO3	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:18 [    INFO] 20:16:15	OptimizationDataCollectionStack-TrustedAdvisorModule-1CTR7HBL4FS5W	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:24 [    INFO] 20:16:21	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	CustomResourceFunctionFinalize	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:24 [    INFO] [92m20:16:24	OptimizationDataCollectionStack-BudgetsModule-1JEK24VASV3FB	LambdaFunction	CREATE_COMPLETE	[0m
20:16:24 [    INFO] 20:16:22	OptimizationDataCollectionStack-CostAnomalyModule-131AXE2H8IVFO	CloudWatchTrigger	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:25 [    INFO] [92m20:16:24	OptimizationDataCollectionStack-EcsChargebackModule-YGRWUOYW1MIN	LambdaFunction	CREATE_COMPLETE	[0m
20:16:25 [    INFO] 20:16:18	OptimizationDataCollectionStack-InventoryCollectorModule-QMOPTCKYVWHA	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:25 [    INFO] 20:16:24	OptimizationDataCollectionStack-OrgDataModule-1SFY1BLZ983WJ	CloudWatchTrigger	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:25 [    INFO] 20:16:18	OptimizationDataCollectionStack-RDSUtilizationModule-EZH21LE0O8LZ	LambdaFunction	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:25 [    INFO] 20:16:24	OptimizationDataCollectionStack-RightsizeModule-URWQVGSRRIKP	CloudWatchTrigger	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:26 [    INFO] 20:16:24	OptimizationDataCollectionStack-TransitGatewayModule-10QOOXTMIQEO3	ModuleStepFunction	CREATE_IN_PROGRESS	[0m
20:16:26 [    INFO] 20:16:24	OptimizationDataCollectionStack-TrustedAdvisorModule-1CTR7HBL4FS5W	ModuleStepFunction	CREATE_IN_PROGRESS	[0m
20:16:32 [    INFO] [92m20:16:28	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	CustomResourceFunctionFinalize	CREATE_COMPLETE	[0m
20:16:32 [    INFO] 20:16:30	OptimizationDataCollectionStack-BudgetsModule-1JEK24VASV3FB	ModuleRefreshSchedule	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:32 [    INFO] 20:16:31	OptimizationDataCollectionStack-EcsChargebackModule-YGRWUOYW1MIN	ModuleRefreshSchedule	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:33 [    INFO] 20:16:32	OptimizationDataCollectionStack-InventoryCollectorModule-QMOPTCKYVWHA	ModuleRefreshSchedule	CREATE_IN_PROGRESS	Resource creation Initiated[0m
20:16:33 [    INFO] 20:16:29	OptimizationDataCollectionStack-RDSUtilizationModule-EZH21LE0O8LZ	ModuleRefreshSchedule	CREATE_IN_PROGRESS	[0m
20:16:33 [    INFO] [92m20:16:32	OptimizationDataCollectionStack-TransitGatewayModule-10QOOXTMIQEO3	ModuleRefreshSchedule	CREATE_COMPLETE	[0m
20:16:34 [    INFO] [92m20:16:31	OptimizationDataCollectionStack-TrustedAdvisorModule-1CTR7HBL4FS5W	ModuleRefreshSchedule	CREATE_COMPLETE	[0m
20:16:40 [    INFO] [92m20:16:34	OptimizationDataCollectionStack-BudgetsModule-1JEK24VASV3FB	CREATE_COMPLETE	[0m
20:16:40 [    INFO] [92m20:16:35	OptimizationDataCollectionStack-EcsChargebackModule-YGRWUOYW1MIN	CREATE_COMPLETE	[0m
20:16:40 [    INFO] [92m20:16:37	OptimizationDataCollectionStack-InventoryCollectorModule-QMOPTCKYVWHA	CREATE_COMPLETE	[0m
20:16:41 [    INFO] [92m20:16:38	OptimizationDataCollectionStack-RDSUtilizationModule-EZH21LE0O8LZ	CREATE_COMPLETE	[0m
20:16:41 [    INFO] [92m20:16:34	OptimizationDataCollectionStack-TransitGatewayModule-10QOOXTMIQEO3	CREATE_COMPLETE	[0m
20:16:41 [    INFO] [92m20:16:34	OptimizationDataCollectionStack-TrustedAdvisorModule-1CTR7HBL4FS5W	CREATE_COMPLETE	[0m
20:16:47 [    INFO] [92m20:16:40	OptimizationDataCollectionStack	RDSUtilizationModule	CREATE_COMPLETE	[0m
20:17:04 [    INFO] 20:17:03	OptimizationDataCollectionStack-PricingModule-901914VXIYMW	RDSEventPermission	CREATE_IN_PROGRESS	[0m
20:17:12 [    INFO] [92m20:17:06	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	EventPermission	CREATE_COMPLETE	[0m
20:17:12 [    INFO] [92m20:17:06	OptimizationDataCollectionStack-PricingModule-901914VXIYMW	CREATE_COMPLETE	[0m
20:17:27 [    INFO] [92m20:17:25	OptimizationDataCollectionStack	PricingModule	CREATE_COMPLETE	[0m
20:17:28 [    INFO] [92m20:17:26	OptimizationDataCollectionStack-CostAnomalyModule-131AXE2H8IVFO	CREATE_COMPLETE	[0m
20:17:29 [    INFO] [92m20:17:28	OptimizationDataCollectionStack-OrgDataModule-1SFY1BLZ983WJ	CREATE_COMPLETE	[0m
20:17:29 [    INFO] [92m20:17:29	OptimizationDataCollectionStack-RightsizeModule-URWQVGSRRIKP	CREATE_COMPLETE	[0m
20:17:43 [    INFO] [92m20:17:42	OptimizationDataCollectionStack	RightsizeModule	CREATE_COMPLETE	[0m
20:17:51 [    INFO] [92m20:17:43	OptimizationDataCollectionStack	OrgDataModule	CREATE_COMPLETE	[0m
20:18:23 [    INFO] 20:18:21	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	FinalizeSetup	CREATE_IN_PROGRESS	[0m
20:18:30 [    INFO] [92m20:18:30	OptimizationDataCollectionStack-ComputeOptimizerModule-KECT5QXCXVVQ	CREATE_COMPLETE	[0m
20:18:38 [    INFO] [92m20:18:37	OptimizationDataCollectionStack	CREATE_COMPLETE	[0m
20:18:40 [    INFO] Emptying the bucket [96mcostoptimizationdata317256447485[0m
20:18:41 [    INFO] arn:aws:states:us-east-1:317256447485:stateMachine:WA-budgets-StateMachine has : [{'executionArn': 'arn:aws:states:us-east-1:317256447485:execution:WA-budgets-StateMachine:49651f19-9e45-4381-8ef1-d1b66c8047ac', 'stateMachineArn': 'arn:aws:states:us-east-1:317256447485:stateMachine:WA-budgets-StateMachine', 'name': '49651f19-9e45-4381-8ef1-d1b66c8047ac', 'status': 'SUCCEEDED', 'startDate': datetime.datetime(2023, 10, 5, 20, 17, 10, 637000, tzinfo=tzlocal()), 'stopDate': datetime.datetime(2023, 10, 5, 20, 17, 13, 369000, tzinfo=tzlocal())}]
20:18:41 [    INFO] Starting arn:aws:states:us-east-1:317256447485:execution:WA-budgets-StateMachine:222bbbf8-4ad1-4725-8d32-ac8316154a97
20:18:41 [    INFO] arn:aws:states:us-east-1:317256447485:stateMachine:WA-ecs-chargeback-StateMachine has : [{'executionArn': 'arn:aws:states:us-east-1:317256447485:execution:WA-ecs-chargeback-StateMachine:9e651f19-9f23-42ce-a266-84b872cab386', 'stateMachineArn': 'arn:aws:states:us-east-1:317256447485:stateMachine:WA-ecs-chargeback-StateMachine', 'name': '9e651f19-9f23-42ce-a266-84b872cab386', 'status': 'SUCCEEDED', 'startDate': datetime.datetime(2023, 10, 5, 20, 17, 13, 125000, tzinfo=tzlocal()), 'stopDate': datetime.datetime(2023, 10, 5, 20, 17, 23, 305000, tzinfo=tzlocal())}]
20:18:41 [    INFO] Starting arn:aws:states:us-east-1:317256447485:execution:WA-ecs-chargeback-StateMachine:ae113d61-0e71-4f70-8354-0cdf46ffe4a1
20:18:41 [    INFO] arn:aws:states:us-east-1:317256447485:stateMachine:WA-inventory-StateMachine has : [{'executionArn': 'arn:aws:states:us-east-1:317256447485:execution:WA-inventory-StateMachine:08651f19-a0ba-4e19-8f93-35dc19c13a2a', 'stateMachineArn': 'arn:aws:states:us-east-1:317256447485:stateMachine:WA-inventory-StateMachine', 'name': '08651f19-a0ba-4e19-8f93-35dc19c13a2a', 'status': 'SUCCEEDED', 'startDate': datetime.datetime(2023, 10, 5, 20, 17, 12, 439000, tzinfo=tzlocal()), 'stopDate': datetime.datetime(2023, 10, 5, 20, 17, 52, 68000, tzinfo=tzlocal())}]
20:18:42 [    INFO] Starting arn:aws:states:us-east-1:317256447485:execution:WA-inventory-StateMachine:ad8474d0-67c5-43ba-925b-19f2055bbe07
20:18:42 [    INFO] arn:aws:states:us-east-1:317256447485:stateMachine:WA-rds-usage-StateMachine has : [{'executionArn': 'arn:aws:states:us-east-1:317256447485:execution:WA-rds-usage-StateMachine:cc651f19-a1b6-48f1-bbec-fff16de111b2', 'stateMachineArn': 'arn:aws:states:us-east-1:317256447485:stateMachine:WA-rds-usage-StateMachine', 'name': 'cc651f19-a1b6-48f1-bbec-fff16de111b2', 'status': 'SUCCEEDED', 'startDate': datetime.datetime(2023, 10, 5, 20, 17, 13, 686000, tzinfo=tzlocal()), 'stopDate': datetime.datetime(2023, 10, 5, 20, 17, 29, 879000, tzinfo=tzlocal())}]
20:18:42 [    INFO] Starting arn:aws:states:us-east-1:317256447485:execution:WA-rds-usage-StateMachine:ae3ab798-44de-4598-8fc4-5186c43fb50b
20:18:42 [    INFO] arn:aws:states:us-east-1:317256447485:stateMachine:WA-transit-gateway-StateMachine has : [{'executionArn': 'arn:aws:states:us-east-1:317256447485:execution:WA-transit-gateway-StateMachine:87651f19-9e52-412b-b939-9e4aa88baa9f', 'stateMachineArn': 'arn:aws:states:us-east-1:317256447485:stateMachine:WA-transit-gateway-StateMachine', 'name': '87651f19-9e52-412b-b939-9e4aa88baa9f', 'status': 'SUCCEEDED', 'startDate': datetime.datetime(2023, 10, 5, 20, 17, 10, 698000, tzinfo=tzlocal()), 'stopDate': datetime.datetime(2023, 10, 5, 20, 17, 23, 865000, tzinfo=tzlocal())}]
20:18:42 [    INFO] Starting arn:aws:states:us-east-1:317256447485:execution:WA-transit-gateway-StateMachine:6681d0cb-3c80-48c6-b5c2-711b06cf72d6
20:18:42 [    INFO] arn:aws:states:us-east-1:317256447485:stateMachine:WA-trusted-advisor-StateMachine has : [{'executionArn': 'arn:aws:states:us-east-1:317256447485:execution:WA-trusted-advisor-StateMachine:d7651f19-9eae-4ae6-b3e2-3d98876b89a7', 'stateMachineArn': 'arn:aws:states:us-east-1:317256447485:stateMachine:WA-trusted-advisor-StateMachine', 'name': 'd7651f19-9eae-4ae6-b3e2-3d98876b89a7', 'status': 'SUCCEEDED', 'startDate': datetime.datetime(2023, 10, 5, 20, 17, 10, 503000, tzinfo=tzlocal()), 'stopDate': datetime.datetime(2023, 10, 5, 20, 17, 24, 29000, tzinfo=tzlocal())}]
20:18:42 [    INFO] Starting arn:aws:states:us-east-1:317256447485:execution:WA-trusted-advisor-StateMachine:93c7ec33-e2ea-4e21-a79e-6ce12661244a
1696537123123
2023-10-05 20:18:43 WA-trusted-advisor-Lambda: [WARNING]	2023-10-05T20:18:43.123Z	0752c437-2b17-4fe5-a349-c8ca51b39963	An error occurred (SubscriptionRequiredException) when calling the DescribeTrustedAdvisorChecks operation: Amazon Web Services Premium Support Subscription is required to use this service.
arn:aws:states:us-east-1:317256447485:execution:WA-ecs-chargeback-StateMachine:ae113d61-0e71-4f70-8354-0cdf46ffe4a1 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-transit-gateway-StateMachine:6681d0cb-3c80-48c6-b5c2-711b06cf72d6 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-trusted-advisor-StateMachine:93c7ec33-e2ea-4e21-a79e-6ce12661244a SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-rds-usage-StateMachine:ae3ab798-44de-4598-8fc4-5186c43fb50b SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-budgets-StateMachine:222bbbf8-4ad1-4725-8d32-ac8316154a97 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-inventory-StateMachine:ad8474d0-67c5-43ba-925b-19f2055bbe07 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-budgets-StateMachine:222bbbf8-4ad1-4725-8d32-ac8316154a97 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-ecs-chargeback-StateMachine:ae113d61-0e71-4f70-8354-0cdf46ffe4a1 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-inventory-StateMachine:ad8474d0-67c5-43ba-925b-19f2055bbe07 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-rds-usage-StateMachine:ae3ab798-44de-4598-8fc4-5186c43fb50b SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-transit-gateway-StateMachine:6681d0cb-3c80-48c6-b5c2-711b06cf72d6 SUCCEEDED
arn:aws:states:us-east-1:317256447485:execution:WA-trusted-advisor-StateMachine:93c7ec33-e2ea-4e21-a79e-6ce12661244a SUCCEEDED
20:21:41 [    INFO] Waiting 1 min
PASSED
test_from_scratch.py::test_cost_explorer_rightsizing_data PASSED
test_from_scratch.py::test_cost_anomaly_data FAILED
test_from_scratch.py::test_ecs_chargeback_data PASSED
test_from_scratch.py::test_inventory_ami_data PASSED
test_from_scratch.py::test_inventory_ebs_data PASSED
test_from_scratch.py::test_inventory_snapshot_data PASSED
test_from_scratch.py::test_rds_usage_data PASSED
test_from_scratch.py::test_organization_data PASSED
test_from_scratch.py::test_trusted_advisor_data FAILED
test_from_scratch.py::test_transit_gateway_data PASSED
test_from_scratch.py::test_compute_optimizer_export_triggered PASSED

=================================== FAILURES ===================================
____________________________ test_cost_anomaly_data ____________________________

athena = <botocore.client.Athena object at 0x7fc8eaf597f0>

    def test_cost_anomaly_data(athena):
>       data = athena_query(athena=athena, sql_query='SELECT * FROM "optimization_data"."cost_anomaly_data" LIMIT 10;')

test_from_scratch.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

athena = <botocore.client.Athena object at 0x7fc8eaf597f0>
sql_query = 'SELECT * FROM "optimization_data"."cost_anomaly_data" LIMIT 10;'
sleep_duration = 1, database = None, catalog = 'AwsDataCatalog'
workgroup = 'primary'

    def athena_query(athena, sql_query, sleep_duration=1, database: str=None, catalog: str='AwsDataCatalog', workgroup: str='primary'):
        """ Executes an AWS Athena Query and return dict"""
        context = {}
        if database: context['Database'] = database
        if catalog: context['Catalog'] = catalog
        response = athena.start_query_execution(
            QueryString=sql_query,
            QueryExecutionContext=context,
            WorkGroup=workgroup,
        )
        query_id = response.get('QueryExecutionId')
        current_status = athena.get_query_execution(QueryExecutionId=query_id)['QueryExecution']['Status']
        while current_status['State'] in ['SUBMITTED', 'RUNNING', 'QUEUED']:
            current_status = athena.get_query_execution(QueryExecutionId=query_id)['QueryExecution']['Status']
            time.sleep(sleep_duration)
        if current_status['State'] != "SUCCEEDED":
            failure_reason = current_status['StateChangeReason']
            logger.debug(f'Full query: {repr(sql_query)}')
>           raise Exception('Athena query failed: {}'.format(failure_reason))
E           Exception: Athena query failed: TABLE_NOT_FOUND: line 1:15: Table 'awsdatacatalog.optimization_data.cost_anomaly_data' does not exist

utils.py:51: Exception
__________________________ test_trusted_advisor_data ___________________________

athena = <botocore.client.Athena object at 0x7fc8eaf597f0>

    def test_trusted_advisor_data(athena):
>       data = athena_query(athena=athena, sql_query='SELECT * FROM "optimization_data"."trusted_advisor_data" LIMIT 10;')

test_from_scratch.py:87: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

athena = <botocore.client.Athena object at 0x7fc8eaf597f0>
sql_query = 'SELECT * FROM "optimization_data"."trusted_advisor_data" LIMIT 10;'
sleep_duration = 1, database = None, catalog = 'AwsDataCatalog'
workgroup = 'primary'

    def athena_query(athena, sql_query, sleep_duration=1, database: str=None, catalog: str='AwsDataCatalog', workgroup: str='primary'):
        """ Executes an AWS Athena Query and return dict"""
        context = {}
        if database: context['Database'] = database
        if catalog: context['Catalog'] = catalog
        response = athena.start_query_execution(
            QueryString=sql_query,
            QueryExecutionContext=context,
            WorkGroup=workgroup,
        )
        query_id = response.get('QueryExecutionId')
        current_status = athena.get_query_execution(QueryExecutionId=query_id)['QueryExecution']['Status']
        while current_status['State'] in ['SUBMITTED', 'RUNNING', 'QUEUED']:
            current_status = athena.get_query_execution(QueryExecutionId=query_id)['QueryExecution']['Status']
            time.sleep(sleep_duration)
        if current_status['State'] != "SUCCEEDED":
            failure_reason = current_status['StateChangeReason']
            logger.debug(f'Full query: {repr(sql_query)}')
>           raise Exception('Athena query failed: {}'.format(failure_reason))
E           Exception: Athena query failed: TABLE_NOT_FOUND: line 1:15: Table 'awsdatacatalog.optimization_data.trusted_advisor_data' does not exist

utils.py:51: Exception
=========================== short test summary info ============================
FAILED test_from_scratch.py::test_cost_anomaly_data - Exception: Athena query...
FAILED test_from_scratch.py::test_trusted_advisor_data - Exception: Athena qu...
=================== 2 failed, 10 passed in 501.02s (0:08:21) ===================
